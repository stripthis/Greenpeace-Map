/**
 * Greenpeace Map Application
 * @author rbertot@greenpeace.org
 * @copyright 2011 Greenpeace International
 *
 * See "MAP Web Author JavaScript API" at
 * http://www.avenza.com/mapublisher/mapwebauthor/api
 */
theMap = AVENZA.embedViewer(
  'map','950','650',
  {
    baseURL:'/map/swf',
    initialZoom:200,
    initialPanX:200,
    initialPanY:600,
    useCentroidForCallouts:true,
    panWidget: false,
    zoomWidget: true,
    searchWidget: false,
    layerWidget: true,
    overviewWidget: false,
    zoomMin:200,
    zoomMax:5000,
    flashSecuritySandbox: AVENZA.AUTO_SANDBOX,
    loadedCB: function () {
      init();
    }
  }
);
    
function init() {
  var m = theMap.element();
  if(m) {
    //alert('m');
    $('#map-nav #home').click(function() {
      m.panHome();
    });
    $('#map-nav #indonesia').click(function() {
      m.panToPointAndZoom(500, 450, 900)
    });
    // safely add an event listener for all browsers
    if (window.addEventListener) {
      m.addEventListener("mousemove", onMouseMove, false);
    } 
    else if (window.attachEvent) { // IE
      m.attachEvent("onmousemove", onMouseMove);
    }
  }
}

function onMouseMove (event) {
  var f = theMap.retrieve(AVENZA.FEATURE);
  //var f = theMap.retrieve(AVENZA.ATTRIBUTES);
  //alert(f.attributes.name);

  if (f.attributes) {
    $("#popup").css("top", event.pageY+20);
    $("#popup").css("left", event.pageX+20);
    $("#popup").css("visibility", "visible");
    $("#name").html(f.attributes.name);   
    $("#stopid").html(f.attributes.stopid);
    //$("#accesible").html(f.attributes.accessible);
    $("#Latitude").html(f.attributes.latitude);
    //$("#Longitude").html(f.attributes.longitude);
    //$("#sundayonly").html(f.attributes.sundayonly);
    //$("#trapezeid").html(f.attributes.trapezeid); 
  } else {
    $("#popup").css("visibility", "hidden");
  }
}